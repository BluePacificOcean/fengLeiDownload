!function($){$.extend({jsonRPC:{version:"2.0",endPoint:null,namespace:null,setup:function(e){return this._validateConfigParams(e),this.endPoint=e.endPoint,this.namespace=e.namespace,this.auth=this.endPoint.match(/^(?:(?![^:@]+:[^:@\/]*@)[^:\/?#.]+:)?(?:\/\/)?(?:([^:@]*(?::[^:@]*)?)?@)?/)[1],this},withOptions:function(e,t){if(this._validateConfigParams(e),"undefined"==typeof t)throw"No callback specified";origParams={endPoint:this.endPoint,namespace:this.namespace},this.setup(e),t.call(this),this.setup(origParams)},request:function(e,t){return"undefined"==typeof t&&(t={id:1}),"undefined"==typeof t.id&&(t.id=1),this._validateRequestMethod(e),this._validateRequestParams(t.params),this._validateRequestCallbacks(t.success,t.error),this._doRequest(JSON.stringify(this._requestDataObj(e,t.params,t.id)),t),!0},batchRequest:function(e,t){if("undefined"==typeof t&&(t={}),!$.isArray(e)||0===e.length)throw"Invalid requests supplied for jsonRPC batchRequest. Must be an array object that contain at least a method attribute";var n=this;$.each(e,function(e,t){n._validateRequestMethod(t.method),n._validateRequestParams(t.params),"undefined"==typeof t.id&&(t.id=e+1)}),this._validateRequestCallbacks(t.success,t.error);for(var s,r=[],i=0;i<e.length;i++)s=e[i],r.push(this._requestDataObj(s.method,s.params,s.id));this._doRequest(JSON.stringify(r),t)},_validateConfigParams:function(e){if("undefined"==typeof e)throw"No params specified";if(e.endPoint&&"string"!=typeof e.endPoint)throw"endPoint must be a string";if(e.namespace&&"string"!=typeof e.namespace)throw"namespace must be a string"},_validateRequestMethod:function(e){if("string"!=typeof e)throw"Invalid method supplied for jsonRPC request";return!0},_validateRequestParams:function(e){if(null!==e&&"undefined"!=typeof e&&"object"!=typeof e&&!$.isArray(e))throw"Invalid params supplied for jsonRPC request. It must be empty, an object or an array.";return!0},_validateRequestCallbacks:function(e,t){if("undefined"!=typeof e&&"function"!=typeof e)throw"Invalid success callback supplied for jsonRPC request";if("undefined"!=typeof t&&"function"!=typeof t)throw"Invalid error callback supplied for jsonRPC request";return!0},_doRequest:function(e,t){var n=this;$.ajax({type:"POST",async:!1!==t.async,dataType:"json",url:this._requestUrl(t.url),data:e,cache:!1,processData:!1,beforeSend:function(e){var s=n._requestAuth(t.url);s&&e.setRequestHeader("Authorization","Basic "+$.base64.encode(s))},error:function(e){n._requestError.call(n,e,t.error)},success:function(e){n._requestSuccess.call(n,e,t.success,t.error)}})},_requestUrl:function(e){return e=e||this.endPoint,e=e.replace(/^((?![^:@]+:[^:@\/]*@)[^:\/?#.]+:)?(\/\/)?(?:(?:[^:@]*(?::[^:@]*)?)?@)?(.*)/,"$1$2$3"),e+"?tm="+(new Date).getTime()},_requestAuth:function(e){return e?e.match(/^(?:(?![^:@]+:[^:@\/]*@)[^:\/?#.]+:)?(?:\/\/)?(?:([^:@]*(?::[^:@]*)?)?@)?/)[1]:this.auth},_requestDataObj:function(e,t,n){var s={jsonrpc:this.version,method:this.namespace?this.namespace+"."+e:e,id:n};return"undefined"!=typeof t&&(s.params=t),s},_requestError:function(e,t){"undefined"!=typeof t&&"function"==typeof t&&t(this._response(e.responseText))},_requestSuccess:function(e,t,n){var s=this._response(e);return s.error&&"function"==typeof n?(n(s),void 0):("function"==typeof t&&t(s),void 0)},_response:function(json){if("undefined"==typeof json||""===json)return{error:"Aria2 RPC \u670d\u52a1\u5668\u9519\u8bef",version:"2.0"};try{if("string"==typeof json&&(json=eval("("+json+")")),$.isArray(json)&&json.length>0&&"2.0"!==json[0].jsonrpc||!$.isArray(json)&&"2.0"!==json.jsonrpc)throw"Version error";return json}catch(e){return{error:"Aria2 RPC \u670d\u52a1\u5668\u9519\u8bef: "+e,version:"2.0"}}}}})}(jQuery);